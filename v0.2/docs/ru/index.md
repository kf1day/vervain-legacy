# Vervain framework

## Оглавление

* Описание
* Настройка
* Карта сайта
  * Файл sitemap.php

## Описание
Vervain – мульти-сайтовый движок, который создавался в первую очередь для передачи управления классу (и методу), предопределенному картой сайта. При обработке запроса формируется две константы:
* `APP_CORE` - определяется расположением `bootstrap.php` - путь для движка и базовых классов
* `APP_SITE` - исходя из переданного сервером `DOCUMENT_ROOT` - корневой путь сайта. Относительно него выбираются пути для файлов конфигурации и пользовательских классов

## Настройка

### bootstrap.php
Движок vervain автоматически осуществляет разбор URI, все запросы к динамическому контенту необходимо передавать на обработку в файл `<engine_version>/bootstrap.php`. 

### Пример конфигурации сайта для nginx
```
server {

	listen 80;
	server_name vervain-demo.domain.tld;

	root /var/www/vervain/sites/demo;

	location ~* \.php$ {
		return 404; 
	}

	location /static/ {
		try_files $uri =404;
		gzip_types *;
		expires 7d;
	}

	location / {
		try_files $uri @baduri;
	}
 
	location @baduri {
		fastcgi_param SCRIPT_FILENAME /var/www/vervain/v0.2/bootstrap.php;
		fastcgi_pass unix:/run/php/php7.0-fpm.sock;
		include fastcgi_params;
	}
}
```

Включаемый файл `fastcgi_params` из поставки `nginx` как правило уже содержит необходимые переменные для передачи PHP-процессору, но некоторые из них напрямую используются движком vervain, и на них следует обратить особое внимание

### Необходимые переменные сервера
#### `DOCUMENT_ROOT`
Корневая директория сайта, определенная сервером, служит для формирования константы `APP_SITE` - относительно содержащегося в ней пути выбираются пути для файлов конфигурации и пользовательских классов

#### `DOCUMENT_URI`
Путь для разбора парсером

#### `HTTPS [on|off]` и `REQUEST_SCHEME`
Служит для определения факта работы сайта по https (например, при построении redirect'ов). `REQUEST_SCHEME` при конфликтах имеет более высокий приоритет
